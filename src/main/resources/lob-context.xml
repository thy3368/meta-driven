<?xml version="1.0" encoding="UTF-8"?>
<beans xmlns="http://www.springframework.org/schema/beans"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="
           http://www.springframework.org/schema/beans
           http://www.springframework.org/schema/beans/spring-beans.xsd">

    <!-- ========================================
         Infrastructure Layer - Repositories
         ======================================== -->
    <bean id="orderBookRepository"
          class="com.tanggo.fund.metadriven.lwc.lob.infrastructure.repositories.InMemoryOrderBookRepository">
        <description>
            订单薄仓储实现（基于内存）
            - 使用TreeMap实现O(log n)性能
            - 支持价格优先、时间优先撮合
            - 无锁化设计满足低时延要求
        </description>
    </bean>

    <!-- ========================================
         Application Layer - Services
         ======================================== -->
    <bean id="orderBookService"
          class="com.tanggo.fund.metadriven.lwc.lob.service.OrderBookService">
        <constructor-arg ref="orderBookRepository"/>
<!--        <description>-->
<!--            订单薄应用服务-->
<!--            - 遵循Clean Architecture依赖倒置原则-->
<!--            - 依赖仓储接口，不依赖具体实现-->
<!--        </description>-->
    </bean>

    <!-- ========================================
         Command Handlers
         ======================================== -->

    <!-- 下单命令处理器 -->
    <bean id="placeOrderCommandHandler"
          class="com.tanggo.fund.metadriven.lwc.lob.handlers.PlaceOrderCommandHandler">
        <property name="orderBookService" ref="orderBookService"/>
    </bean>

    <!-- 撤单命令处理器 -->
    <bean id="cancelOrderCommandHandler"
          class="com.tanggo.fund.metadriven.lwc.lob.handlers.CancelOrderCommandHandler">
        <property name="orderBookService" ref="orderBookService"/>
    </bean>

    <!-- 查询订单薄命令处理器 -->
    <bean id="queryOrderBookCommandHandler"
          class="com.tanggo.fund.metadriven.lwc.lob.handlers.QueryOrderBookCommandHandler">
        <property name="orderBookService" ref="orderBookService"/>
    </bean>

    <!-- ========================================
         Command Handler Registry (使用Map配置)
         ======================================== -->
    <bean id="lobCommandHandlerRegistry" class="java.util.HashMap">
        <constructor-arg>
            <map key-type="java.lang.String"
                 value-type="com.tanggo.fund.metadriven.lwc.cqrs.ICommandHandler">
                <entry key="placeOrder" value-ref="placeOrderCommandHandler"/>
                <entry key="cancelOrder" value-ref="cancelOrderCommandHandler"/>
                <entry key="queryOrderBook" value-ref="queryOrderBookCommandHandler"/>
            </map>
        </constructor-arg>
    </bean>

</beans>
