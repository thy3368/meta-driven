spring:
  application:
    name: meta-driven

server:
  address: 0.0.0.0

# ============================================
# Actuator & Metrics 配置
# ============================================
management:
  endpoints:
    web:
      exposure:
        include: health,info,metrics,prometheus,loggers
      base-path: /actuator
  endpoint:
    health:
      show-details: when_authorized
      probes:
        enabled: true  # Kubernetes 探针支持
    prometheus:
      enabled: true

  metrics:
    distribution:
      percentiles-histogram:
        http.server.requests: true
        business.processing.time: true
      percentiles:
        http.server.requests: 0.5, 0.9, 0.95, 0.99, 0.999, 0.9999
        business.processing.time: 0.5, 0.9, 0.95, 0.99, 0.999, 0.9999
      minimum-expected-value:
        http.server.requests: 1ms
        business.processing.time: 100ns
      maximum-expected-value:
        http.server.requests: 10s
        business.processing.time: 100ms
    tags:
      application: ${spring.application.name}
      environment: ${ENVIRONMENT:local}
    export:
      prometheus:
        step: 5s  # 更频繁刷新

# ============================================
# Tracing 配置 (OpenTelemetry)
# ============================================
  tracing:
    sampling:
      probability: 1.0  # 生产环境建议 0.1 (10% 采样)
    propagation:
      type: w3c  # W3C Trace Context 标准

  otlp:
    tracing:
      endpoint: http://tempo:4318/v1/traces  # Tempo OTLP HTTP 端点

# ============================================
# Logging 配置
# ============================================
logging:
  level:
    root: INFO
    com.tanggo.fund: DEBUG
  pattern:
    correlation: "[${spring.application.name:},%X{traceId:-},%X{spanId:-}]"